# 2D-3D Projection ê¸°ëŠ¥ ì„¤ê³„

## ê°œìš”

ì´ë¯¸ì§€ì—ì„œ í´ë¦­í•œ ì (2D í”½ì…€ ì¢Œí‘œ)ì„ ë©”ì‹œì˜ 3D ë¡œì»¬ ì¢Œí‘œë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ìƒíƒœ** | ğŸ”„ ì„¤ê³„ ì¤‘ |
| **ëª©í‘œ** | ì´ë¯¸ì§€ í´ë¦­ â†’ 3D ë©”ì‹œ ì¢Œí‘œ íšë“ |
| **í™œìš©** | ê²°í•¨ ìœ„ì¹˜ ë§¤í•‘, ì¸¡ì •, ì£¼ì„ |

---

## í•µì‹¬ ì›ë¦¬

```
ì´ë¯¸ì§€ í´ë¦­ (u, v)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ì •ê·œí™” ì¢Œí‘œ ê³„ì‚°                                â”‚
â”‚     x_norm = (u - cx) / fx                          â”‚
â”‚     y_norm = (v - cy) / fy                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ì¹´ë©”ë¼ ì¢Œí‘œê³„ ê´‘ì„                               â”‚
â”‚     ray_cam = [x_norm, y_norm, 1]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ì›”ë“œ ì¢Œí‘œê³„ë¡œ ë³€í™˜                              â”‚
â”‚     ray_world = R^T Â· ray_cam                       â”‚
â”‚     camera_pos = -R^T Â· t                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Ray-Mesh Intersection                           â”‚
â”‚     camera_pos â†’ ray_world ë°©í–¥ìœ¼ë¡œ ê´‘ì„  ë°œì‚¬       â”‚
â”‚     ë©”ì‹œì™€ êµì°¨ì  = 3D ì¢Œí‘œ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   3D ì¢Œí‘œ (X, Y, Z)
```

---

## í•„ìš”í•œ ì •ë³´

### ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„°

| íŒŒë¼ë¯¸í„° | ì„¤ëª… | í˜„ì¬ ìƒíƒœ |
|----------|------|-----------|
| **fx, fy** | ì´ˆì ê±°ë¦¬ (í”½ì…€ ë‹¨ìœ„) | âŒ CSVì— ì—†ìŒ |
| **cx, cy** | ì£¼ì  ì¢Œí‘œ | âŒ CSVì— ì—†ìŒ |
| **R** | íšŒì „ í–‰ë ¬ (3Ã—3) | âœ… HPRì—ì„œ ê³„ì‚° ê°€ëŠ¥ |
| **t** | ì´ë™ ë²¡í„° | âœ… x,y,zì—ì„œ ê³„ì‚° |
| **ì´ë¯¸ì§€ í¬ê¸°** | width, height | âŒ CSVì— ì—†ìŒ |

### RealityScan ì¶”ì¶œ ì˜µì…˜ ë¹„êµ

| í˜•ì‹ | ì¥ì  | ë‹¨ì  | ì¶”ì²œ |
|------|------|------|------|
| **COLMAP** | Undistorted, ì™„ì „í•œ íŒŒë¼ë¯¸í„° | ì¬ë‚´ë³´ë‚´ê¸° í•„ìš” | â­ ê¶Œì¥ |
| **XMP** | ì´ë¯¸ì§€ë³„ ìƒì„¸ ì •ë³´ | íŒŒì‹± í•„ìš” | ê´œì°®ìŒ |
| **CSV** | í˜„ì¬ ì‚¬ìš© ì¤‘ | ë‚´ë¶€ íŒŒë¼ë¯¸í„° ë¶€ì¡± | ë³´ì™„ í•„ìš” |

---

## TODO: í™•ì¸ í•­ëª©

### 1ë‹¨ê³„: ë°ì´í„° í™•ì¸

- [x] **í˜„ì¬ CSV íŒŒì¼ êµ¬ì¡° í™•ì¸** âœ… 2026-01-13
  - íŒŒì¼: `SimplifyModel-cameras.csv` (1,289ê°œ ì¹´ë©”ë¼)
  - ì»¬ëŸ¼: `name, x, y, z, heading, pitch, roll`
  - âŒ **fx, fy, cx, cy ì—†ìŒ** â†’ ë‚´ë¶€ íŒŒë¼ë¯¸í„° ëˆ„ë½
  - âŒ **ì´ë¯¸ì§€ í•´ìƒë„ ì—†ìŒ**

- [ ] **RealityScan í”„ë¡œì íŠ¸ì—ì„œ ì¶”ê°€ ë‚´ë³´ë‚´ê¸°** â­ ë‹¤ìŒ ë‹¨ê³„
  - [ ] COLMAP í˜•ì‹ ë‚´ë³´ë‚´ê¸° (ê¶Œì¥)
  - [ ] ë˜ëŠ” XMP ë©”íƒ€ë°ì´í„° ë‚´ë³´ë‚´ê¸°

- [ ] **ì›ë³¸ ì´ë¯¸ì§€ í•´ìƒë„ í™•ì¸**
  - DJI ë“œë¡  ì´ë¯¸ì§€ EXIFì—ì„œ í™•ì¸ ê°€ëŠ¥
  - ëª¨ë“  ì´ë¯¸ì§€ ë™ì¼ í•´ìƒë„ì¸ì§€

- [ ] **ë“œë¡  EXIFì—ì„œ ì´ˆì ê±°ë¦¬ ì¶”ì¶œ** (ëŒ€ì•ˆ)
  - DJI ì´ë¯¸ì§€ì— FocalLength ì •ë³´ í¬í•¨ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ
  - ëª¨ë“  ì´ë¯¸ì§€ ë™ì¼ ë Œì¦ˆ ì‚¬ìš© ì‹œ ì¼ê´„ ì ìš© ê°€ëŠ¥

### 2ë‹¨ê³„: ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„° ê²°ì •

- [ ] **ë‚´ë¶€ íŒŒë¼ë¯¸í„° íšë“ ë°©ë²• ê²°ì •**
  - ì˜µì…˜ A: COLMAP í˜•ì‹ìœ¼ë¡œ ì¬ë‚´ë³´ë‚´ê¸° â­ ê¶Œì¥
  - ì˜µì…˜ B: XMPì—ì„œ FocalLength35mm ë³€í™˜
  - ì˜µì…˜ C: ë“œë¡  EXIFì—ì„œ ì¶”ì¶œ

- [ ] **ì™œê³¡ ë³´ì • í•„ìš” ì—¬ë¶€ ê²°ì •**
  - COLMAP Undistorted ì´ë¯¸ì§€ ì‚¬ìš©í•˜ë©´ ë¶ˆí•„ìš”
  - ì›ë³¸ ì´ë¯¸ì§€ ì‚¬ìš© ì‹œ Distortion Coefficients í•„ìš”

### 3ë‹¨ê³„: ì¢Œí‘œê³„ í™•ì¸

- [ ] **ì¢Œí‘œê³„ ë³€í™˜ ì ìš© í™•ì¸**
  - RealityScan: Z-up
  - Three.js: Y-up
  - í˜„ì¬ `worldGroup.rotation.x = -Math.PI/2` ì ìš© ì¤‘
  - Ray ê³„ì‚° ì‹œ ë™ì¼í•˜ê²Œ ì ìš© í•„ìš”

- [ ] **ì¹´ë©”ë¼ ìœ„ì¹˜/ë°©í–¥ ê²€ì¦**
  - í˜„ì¬ Best View ê¸°ëŠ¥ì—ì„œ ì¹´ë©”ë¼ ìœ„ì¹˜ ì •ìƒ ì‘ë™ í™•ì¸
  - ê°™ì€ ë³€í™˜ ë¡œì§ ì¬ì‚¬ìš© ê°€ëŠ¥

### 4ë‹¨ê³„: êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸

- [ ] **Three.js Raycaster í…ŒìŠ¤íŠ¸**
  - ì¹´ë©”ë¼ ìœ„ì¹˜ì—ì„œ ê´‘ì„  ë°œì‚¬
  - ë©”ì‹œì™€ êµì°¨ì  í™•ì¸

- [ ] **ì •í™•ë„ ê²€ì¦**
  - ì•Œë ¤ì§„ ì  (ì˜ˆ: ëª¨ì„œë¦¬)ì—ì„œ í…ŒìŠ¤íŠ¸
  - 2D í´ë¦­ â†’ 3D ì¢Œí‘œ â†’ ë‹¤ì‹œ 2D íˆ¬ì˜ ë¹„êµ

---

## êµ¬í˜„ ì˜ˆì‹œ

### XMP â†’ ì¹´ë©”ë¼ í–‰ë ¬ ë³€í™˜ (Python)

```python
# RealityScan.md ì°¸ì¡°
def xmp_to_camera_matrix(xmp_path, image_width, image_height):
    # FocalLength35mm â†’ í”½ì…€ ì´ˆì ê±°ë¦¬
    max_dim = max(image_width, image_height)
    fx = (focal_35mm / 36.0) * max_dim
    fy = fx * aspect_ratio
    cx = image_width / 2.0 + pp_u * max_dim
    cy = image_height / 2.0 + pp_v * max_dim

    K = [[fx, 0, cx], [0, fy, cy], [0, 0, 1]]
    return K, R, t
```

### Three.js êµ¬í˜„ (TypeScript)

```typescript
interface CameraIntrinsics {
  fx: number;
  fy: number;
  cx: number;
  cy: number;
  width: number;
  height: number;
}

interface CameraExtrinsics {
  position: THREE.Vector3;
  rotation: THREE.Matrix3;  // R
}

function pixelTo3D(
  u: number,
  v: number,
  intrinsics: CameraIntrinsics,
  extrinsics: CameraExtrinsics,
  mesh: THREE.Mesh
): THREE.Vector3 | null {

  // 1. ì •ê·œí™” ì¢Œí‘œ
  const x_norm = (u - intrinsics.cx) / intrinsics.fx;
  const y_norm = (v - intrinsics.cy) / intrinsics.fy;

  // 2. ì¹´ë©”ë¼ ì¢Œí‘œê³„ ê´‘ì„ 
  const ray_cam = new THREE.Vector3(x_norm, y_norm, 1).normalize();

  // 3. ì›”ë“œ ì¢Œí‘œê³„ë¡œ ë³€í™˜ (R^T)
  const R_inv = extrinsics.rotation.clone().transpose();
  const ray_world = ray_cam.clone().applyMatrix3(R_inv).normalize();

  // 4. Z-up â†’ Y-up ì¢Œí‘œê³„ ë³€í™˜ (í•„ìš”ì‹œ)
  // ray_worldë¥¼ worldGroup ë³€í™˜ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬

  // 5. Raycasterë¡œ êµì°¨ì  ì°¾ê¸°
  const raycaster = new THREE.Raycaster(
    extrinsics.position,
    ray_world
  );
  const intersects = raycaster.intersectObject(mesh, true);

  if (intersects.length > 0) {
    return intersects[0].point;
  }
  return null;
}
```

### HPR â†’ Rotation Matrix ë³€í™˜

```typescript
// í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë¡œì§ ì°¸ì¡°
function hprToRotationMatrix(
  heading: number,  // degrees
  pitch: number,    // degrees (90 = ìˆ˜í‰)
  roll: number      // degrees
): THREE.Matrix3 {
  // RealityScan HPR ì •ì˜:
  // Heading: ë¶ìª½ ê¸°ì¤€ ì‹œê³„ë°©í–¥
  // Pitch: 90Â° = ìˆ˜í‰ ì´¬ì˜ (ì£¼ì˜!)
  // Roll: ì¹´ë©”ë¼ ê¸°ìš¸ê¸°

  const h = THREE.MathUtils.degToRad(heading);
  const p = THREE.MathUtils.degToRad(pitch - 90);  // ì¼ë°˜ ì¢Œí‘œê³„ë¡œ ë³€í™˜
  const r = THREE.MathUtils.degToRad(roll);

  // ... íšŒì „ í–‰ë ¬ ê³„ì‚°
}
```

---

## ì°¸ê³  ë¬¸ì„œ

### í”„ë¡œì íŠ¸ ë‚´ë¶€
- [[dev-Freaktech-001-PoC Index]] - í”„ë¡œì íŠ¸ ê°œìš”
- [[dev-Freaktech-001-PoC Issues#ì¢Œí‘œê³„ ë³€í™˜ ë¬¸ì œ]] - Z-up â†’ Y-up í•´ê²° ë°©ë²•
- [[dev-Freaktech-001-PoC Issues#ì¹´ë©”ë¼ ë°©í–¥ ë²¡í„° ë¬¸ì œ OPK]] - HPR ì‚¬ìš© ë°°ê²½
- [[dev-Freaktech-001-PoC Workflows]] - GLB ìƒì„± ì›Œí¬í”Œë¡œìš°

### ë°©ë²•ë¡  (Inbox)
- [[3D Defect Mapping]] - 2Dâ†’3D ë³€í™˜ ìƒì„¸ ì•Œê³ ë¦¬ì¦˜, RealityScanDefectMapper í´ë˜ìŠ¤
- [[RealityScan]] - XMP/COLMAP ë‚´ë³´ë‚´ê¸°, ì¹´ë©”ë¼ íŒŒë¼ë¯¸í„° ë³€í™˜ ê³µì‹
- [[XMP]] - XMP ë©”íƒ€ë°ì´í„° í˜•ì‹, RealityScan í•„ë“œ ì„¤ëª…
- [[SfM]] - Structure from Motion ê¸°ì´ˆ

### ì™¸ë¶€ ì°¸ê³ 
- [RealityScan XMP Camera Math](https://dev.epicgames.com/community/learning/knowledge-base/vzwB/realityscan-realitycapture-xmp-camera-math)
- [Three.js Raycaster](https://threejs.org/docs/#api/en/core/Raycaster)

---

## ì§„í–‰ ê¸°ë¡

| ë‚ ì§œ | ë‚´ìš© |
|------|------|
| 2026-01-13 | ë¬¸ì„œ ìƒì„±, ë°©ë²•ë¡  ì¡°ì‚¬ ì™„ë£Œ |
| 2026-01-13 | CSV ë¶„ì„ ì™„ë£Œ - ë‚´ë¶€ íŒŒë¼ë¯¸í„° ëˆ„ë½ í™•ì¸, COLMAP/XMP ë‚´ë³´ë‚´ê¸° í•„ìš” |
